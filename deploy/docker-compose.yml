services:
  api:
    build:
      context: ..
      dockerfile: Dockerfile
    image: ghcr.io/${GITHUB_REPO_OWNER:-local}/cats-dogs-inference:api
    ports:
      - "8000:8000"
    environment:
      - MODEL_PATH=/app/models/model.keras
      - LABEL_MAP_PATH=/app/models/label_map.json
    volumes:
      - ../models:/app/models:ro

  ui:
    build:
      context: ..
      dockerfile: Dockerfile.ui
    image: ghcr.io/${GITHUB_REPO_OWNER:-local}/cats-dogs-inference:ui
    ports:
      - "7860:7860"
    environment:
      - API_URL=http://api:8000/predict
    depends_on:
      - api
